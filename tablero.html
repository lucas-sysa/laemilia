<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Dashboard Semanal</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 20px; }
    h1 { text-align: center; margin-bottom: 10px; }
    #reloj { 
      text-align: center; 
      font-size: 28px; 
      font-weight: bold; 
      color: #007bff; 
      margin-bottom: 20px;
    }
    table { width: 100%; border-collapse: collapse; background: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 10px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    th { background: #007bff; color: #fff; }
    tr:nth-child(even) { background: #f9f9f9; }
    .objetivo { font-weight: bold; color: #007bff; }
    .cumple { color: green; font-weight: bold; }
    .no-cumple { color: red; font-weight: bold; }
    #ultima-actualizacion { font-size: 14px; color: #555; text-align: right; margin-top: 5px; }
  </style>
</head>
<body>
  <h1>ðŸ“Š Dashboard de Indicadores</h1>
  <div id="reloj"></div>
  <table id="dashboard"></table>
  <div id="ultima-actualizacion"></div>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbyealWyhnT1-Q2yoPQzRGjk5RJZmB7Dc77JmlcrwS6iW2-nyEqK1nlqus4VyoA1-syXFg/exec"; 

    // FunciÃ³n para cargar datos
    async function cargarDatos() {
      let res = await fetch(scriptURL);
      let data = await res.json();

      let headers = data[0];
      let rows = data.slice(1);
      let table = document.getElementById("dashboard");

      table.innerHTML = "<thead><tr>" + headers.map(h => `<th>${h}</th>`).join("") + "</tr></thead>";

      let body = "<tbody>";
      rows.forEach(r => {
        let objetivo = parseFloat(r[2]) || 0; 
        body += "<tr>" + r.map((c,i) => {
          if(i===2) {
            return `<td class="objetivo">${c || ""}</td>`;
          } else if(i > 2) { 
            let valor = parseFloat(c);
            if(!isNaN(valor)) {
              return `<td class="${valor >= objetivo ? 'cumple' : 'no-cumple'}">${c}</td>`;
            }
          }
          return `<td>${c || ""}</td>`;
        }).join("") + "</tr>";
      });
      body += "</tbody>";
      table.innerHTML += body;

      // Actualizar hora de Ãºltima actualizaciÃ³n
      const ahora = new Date();
      document.getElementById("ultima-actualizacion").innerText = 
        "Ãšltima actualizaciÃ³n: " + ahora.toLocaleString();
    }

    // Reloj en vivo con fecha completa
    function actualizarReloj() {
      const ahora = new Date();
      const opciones = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute:'2-digit', second:'2-digit' };
      document.getElementById("reloj").innerText = ahora.toLocaleDateString('es-ES', opciones);
    }
    // Primera carga
    cargarDatos();
    actualizarReloj();

    // Refrescar datos cada 1 minuto
    setInterval(cargarDatos, 60000);

    // Actualizar reloj cada segundo
    setInterval(actualizarReloj, 1000);
  </script>
</body>
</html>

